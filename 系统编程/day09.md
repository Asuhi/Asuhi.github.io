#Linux系统编程 day09
####本章主要介绍POSIX线程模型

##程序，进程，线程
**程序：**完成特点功能的一系列有序指令的集合
可执行文件
这个文件是按照一定的格式组成的
*代码段+数据段*

**进程：**是程序的一次动态执行过程
*代码段+数据段+堆栈段+PCB(进程控制块)*

**线程：**一个程序里的一个执行路线就叫做线程
线程是一个进程内部的**控制序列**

**进程是资源竞争的基本单位**
**线程是程序执行的最小单位**

##线程共享进程的数据

1. 线程ID
2. 一组寄存器(IP SP) 指令寄存器和堆栈寄存器
3. 栈
4. errno
5. 信号状态
6. 优先级

在进程创建新线程时，新线程会拥有自己的堆栈，但要与创建者共享全局变量，文件描述符，信号处理器和当前的工作目录

##线程的优缺点

**优点:**

* 线程占用资源比进程要少很多
* 线程直接的切换操作系统的工作比进程少很多(线程更快)
* 多线程可以充分利用多核处理器的并行数量
* 在等待慢速IO操作程序可以执行其他计算任务，进程如果阻塞在IO操作就不能执行其他任务了
* 计算密集型和IO密集型任务，多线程可以充分利用，例如在处理大型并发网络IO时我们可以放在线程池中处理


**缺点:**

* 性能损失：一个程序有很多计算密集型线程，往往无法与其他线程共用处理器如果计算密集线程比处理器多
就会有大的性能损失，这里的性能损失就是额外的调度开销
* 健壮性降低：多线程程序共享一个地址空间，如果一个线程破坏了共享变量，可能影响其他线程的工作
* 缺乏访问控制：一个线程调用了OS函数就会对整个进程造成影响，例如某个进程改变了工作目录整个进程也会改变
* 编程难度提高

##线程调度竞争范围

线程在调度cpu时间片不一样
进程竞争范围，线程在同一个进程竞争cpu时间(不直接和其他进程竞争时间)
系统竞争范围，线程和系统范围内的其他线程竞争

##三种线程模型

* **N:1  用户线程模型**
内核不干涉线程的活动
系统没有线程支持
在该模型中多个线程只能调度到一个CPU，限制了可用的并行总量
这些线程只能分享单个进程竞争到的CPU时间片
只要一个线程阻塞，其他线程也不能工作了
这种线程代价比较小，只在用户空间创建

* **1:1  核心线程模型**
操作系统占据了核心线程
每一个进程上面的多个线程可对应多个核心线程
用户线程和核心线程是 1:1 的关系
每个线程可以参与到cpu的竞争
线程调度需要操作系统完成开销较大，但能充分发挥多核处理器的优势

* **N:M  混合线程模型**
该模型提供了两级控制
将用户线程映射为系统的可调度体(LWP:轻量级线程)
然后LWP在一一映射到核心线程

**POSIX线程就是使用的M:M线程模型**

